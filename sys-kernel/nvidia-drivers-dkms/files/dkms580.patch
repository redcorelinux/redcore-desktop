diff -Nur a/kernel/dkms.conf b/kernel/dkms.conf
--- a/kernel/dkms.conf	2023-03-28 23:02:32.000000000 +0100
+++ b/kernel/dkms.conf	2023-05-12 18:40:21.194005773 +0100
@@ -1,12 +1,22 @@
-PACKAGE_NAME="nvidia"
-PACKAGE_VERSION="__VERSION_STRING"
+PACKAGE_NAME="nvidia-drivers-dkms"
+PACKAGE_VERSION="580.95.05"
+BUILD_EXCLUSIVE_KERNEL="^(5\.[0-9]+\.|6\.[0-9]\.|\.|6\.1[0-8]\.)" # only build for kernels v5.x.x up to and including v6.18.x
 AUTOINSTALL="yes"
 
 # By default, DKMS will add KERNELRELEASE to the make command line; however,
 # this will cause the kernel module build to infer that it was invoked via
 # Kbuild directly instead of DKMS. The dkms(8) manual page recommends quoting
 # the 'make' command name to suppress this behavior.
-MAKE[0]="'make' -j__JOBS NV_EXCLUDE_BUILD_MODULES='__EXCLUDE_MODULES' KERNEL_UNAME=${kernelver} modules"
+MAKE[0]="'make' -j`nproc` NV_EXCLUDE_BUILD_MODULES='__EXCLUDE_MODULES' KERNEL_UNAME=${kernelver} IGNORE_CC_MISMATCH='__IGNORE_CC_MISMATCH' modules"
 
 # The list of kernel modules will be generated by nvidia-installer at runtime.
-__DKMS_MODULES
+BUILT_MODULE_NAME[0]="nvidia"
+DEST_MODULE_LOCATION[0]="/extra/dkms"
+BUILT_MODULE_NAME[1]="nvidia-uvm"
+DEST_MODULE_LOCATION[1]="/extra/dkms"
+BUILT_MODULE_NAME[2]="nvidia-modeset"
+DEST_MODULE_LOCATION[2]="/extra/dkms"
+BUILT_MODULE_NAME[3]="nvidia-drm"
+DEST_MODULE_LOCATION[3]="/extra/dkms"
+BUILT_MODULE_NAME[4]="nvidia-peermem"
+DEST_MODULE_LOCATION[4]="/extra/dkms"
diff -Nur a/kernel-open/dkms.conf b/kernel-open/dkms.conf
--- a/kernel-open/dkms.conf	2023-03-28 23:02:32.000000000 +0100
+++ b/kernel-open/dkms.conf	2023-05-12 18:40:30.254006616 +0100
@@ -1,12 +1,22 @@
-PACKAGE_NAME="nvidia"
-PACKAGE_VERSION="__VERSION_STRING"
+PACKAGE_NAME="nvidia-drivers-dkms"
+PACKAGE_VERSION="580.95.05"
+BUILD_EXCLUSIVE_KERNEL="^(5\.[0-9]+\.|6\.[0-9]\.|\.|6\.1[0-8]\.)" # only build for kernels v5.x.x up to and including v6.18.x
 AUTOINSTALL="yes"
 
 # By default, DKMS will add KERNELRELEASE to the make command line; however,
 # this will cause the kernel module build to infer that it was invoked via
 # Kbuild directly instead of DKMS. The dkms(8) manual page recommends quoting
 # the 'make' command name to suppress this behavior.
-MAKE[0]="'make' -j__JOBS NV_EXCLUDE_BUILD_MODULES='__EXCLUDE_MODULES' KERNEL_UNAME=${kernelver} modules"
+MAKE[0]="'make' -j`nproc` NV_EXCLUDE_BUILD_MODULES='__EXCLUDE_MODULES' KERNEL_UNAME=${kernelver} IGNORE_CC_MISMATCH='__IGNORE_CC_MISMATCH' modules"
 
 # The list of kernel modules will be generated by nvidia-installer at runtime.
-__DKMS_MODULES
+BUILT_MODULE_NAME[0]="nvidia"
+DEST_MODULE_LOCATION[0]="/extra/dkms"
+BUILT_MODULE_NAME[1]="nvidia-uvm"
+DEST_MODULE_LOCATION[1]="/extra/dkms"
+BUILT_MODULE_NAME[2]="nvidia-modeset"
+DEST_MODULE_LOCATION[2]="/extra/dkms"
+BUILT_MODULE_NAME[3]="nvidia-drm"
+DEST_MODULE_LOCATION[3]="/extra/dkms"
+BUILT_MODULE_NAME[4]="nvidia-peermem"
+DEST_MODULE_LOCATION[4]="/extra/dkms"
